#!/bin/bash

# dev - Simple development server startup with real-time error output

set -e

echo "🧹 Cleaning up any existing development processes..."
pkill -f "node.*backend/api/server.js" 2>/dev/null || true
pkill -f "nodemon" 2>/dev/null || true
sleep 1

echo "🧪 Running quick tests..."
# Run tests but don't block the server if they fail
if npx jest --testPathPattern=unit.test.js --verbose --silent; then
    echo "✅ Tests passed"
else
    echo "⚠️ Some tests failed, but starting server anyway for development"
fi

echo ""
echo "🚀 Starting development server with live reload..."
echo "📱 HTTP: http://localhost:8080"
echo "🔒 HTTPS: https://localhost:3001"
echo "🔄 Live reload: Active (watches frontend/ directory)"
echo "💡 Press Ctrl+C to stop"
echo "=" | tr '=' '=' | head -c 60 && echo ""

# Start nodemon with verbose output so you can see all errors
exec npx nodemon --verbose backend/api/server.js 