#!/bin/bash

# dev - Simple development server startup with real-time error output

set -e

echo "ğŸ§¹ Cleaning up any existing development processes..."
pkill -f "node.*backend/api/server.js" 2>/dev/null || true
pkill -f "nodemon" 2>/dev/null || true
sleep 1

echo "ğŸ§ª Running quick tests..."
# Run tests but don't block the server if they fail
if npx jest --testPathPattern=unit.test.js --verbose --silent; then
    echo "âœ… Tests passed"
else
    echo "âš ï¸ Some tests failed, but starting server anyway for development"
fi

echo ""
echo "ğŸš€ Starting development server with live reload..."
echo "ğŸ“± HTTP: http://localhost:8080"
echo "ğŸ”’ HTTPS: https://localhost:3001"
echo "ğŸ”„ Live reload: Active (watches frontend/ directory)"
echo "ğŸ’¡ Press Ctrl+C to stop"
echo "=" | tr '=' '=' | head -c 60 && echo ""

# Start nodemon with verbose output so you can see all errors
exec npx nodemon --verbose backend/api/server.js 