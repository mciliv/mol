# Molecular Data Handling Patterns

## SMILES Validation
- **Always validate SMILES** before processing with RDKit
- Reject molecular formulas like "CaCO3" - only accept valid SMILES notation
- Check for balanced parentheses in SMILES strings
- Use RDKit's parsing capabilities to validate structure
- Handle invalid SMILES gracefully with clear error messages

## SDF File Generation
- Generate SDF files in dedicated `sdf_files/` directory
- Use URL-safe filenames for generated SDF files
- Always check if RDKit can parse SMILES before attempting 3D coordinate generation
- Implement proper error handling for Python subprocess calls
- Use consistent file naming conventions

## 3D Structure Requirements
- **Sphere representation ONLY** - NO ball-and-stick models
- Use van der Waals radii with scale factor 0.8
- Set black background (#000000) for all molecular viewers
- Implement proper viewer cleanup and memory management
- Handle empty or invalid SDF data gracefully

## Data Flow Patterns
- Validate input data using Zod schemas before processing
- Use consistent JSON response format: `{ output: {...} }`
- Implement proper error responses with meaningful messages
- Handle batch processing of multiple molecules efficiently
- Cache generated SDF files to avoid regeneration

## Python Integration
- Use RDKit for all molecular operations and structure generation
- Handle Python subprocess errors gracefully
- Log both successful operations and errors with clear messages
- Use absolute paths for file operations
- Implement proper cleanup of temporary files

## Error Handling
```javascript
// API calls
try {
  const response = await fetch('/api/endpoint');
  if (!response.ok) throw new Error(`HTTP ${response.status}`);
  const data = await response.json();
} catch (error) {
  console.error('Operation failed:', error);
}

// Python subprocess
try {
  const result = execSync('python script.py', { encoding: 'utf-8' });
} catch (error) {
  console.error('Python execution failed:', error.message);
}
```
description:
globs:
alwaysApply: false
---
